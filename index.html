<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ¡ãƒ¢PWA</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#667eea">

<style>
body {
  margin: 0;
  font-family: sans-serif;
  background: #f5f5f5;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

header {
  position: sticky;
  top: 0;
  background: #667eea;
  color: white;
  padding: 12px;
  text-align: center;
  z-index: 10;
}

.hidden { display: none; }

input, textarea, select, button {
  width: 100%;
  padding: 10px;
  margin-bottom: 8px;
  box-sizing: border-box;
  font-size: 16px;
}

button {
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

ul {
  list-style: none;
  padding: 0;
  margin: 0;
  overflow-y: auto;
}

li {
  background: white;
  margin: 8px;
  padding: 12px;
  border-radius: 8px;
  cursor: pointer;
}

.note-title { font-weight: bold; }
.note-meta { font-size: 12px; color: #666; }

.fab {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #667eea;
  color: white;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  font-size: 28px;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}

.deleteBtn { background: #e74c3c; color: white; }
.restoreBtn { background: #2ecc71; color: white; }
.exportBtn { background: #3498db; color: white; }
.backupBtn { background: #8e44ad; color: white; }

#noteList, #trashList {
  max-height: calc(100vh - 180px);
  overflow-y: auto;
  padding-bottom: 80px;
}

#editView {
  display: flex;
  flex-direction: column;
  height: calc(100vh - 48px);
  padding: 12px;
  box-sizing: border-box;
}

#contentInput {
  flex: 1;
  min-height: 200px;
  resize: vertical;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

#editButtons {
  display: flex;
  gap: 8px;
  position: sticky;
  bottom: 0;
  background: #f5f5f5;
  padding: 8px 0;
}
</style>
</head>
<body>

<header id="headerTitle">ãƒ¡ãƒ¢ä¸€è¦§</header>

<div id="listView">
  <input id="searchInput" placeholder="æ¤œç´¢" oninput="loadList()">

  <select id="categoryFilter" onchange="loadList()">
    <option value="">ã™ã¹ã¦</option>
    <option value="ä»•äº‹">ä»•äº‹</option>
    <option value="ç§ç”¨">ç§ç”¨</option>
    <option value="ãã®ä»–">ãã®ä»–</option>
  </select>

  <button class="backupBtn" onclick="backupAll()">ğŸ“¦ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
  <button class="backupBtn" onclick="restoreAll()">ğŸ“¥ å¾©å…ƒ</button>
  <button onclick="showTrash()">ğŸ—‘ ã‚´ãƒŸç®±</button>

  <ul id="noteList"></ul>
  <button class="fab" onclick="newNote()">ï¼‹</button>
</div>

<div id="editView" class="hidden">
  <input id="titleInput" placeholder="ã‚¿ã‚¤ãƒˆãƒ«">
  <select id="categoryInput">
    <option value="ä»•äº‹">ä»•äº‹</option>
    <option value="ç§ç”¨">ç§ç”¨</option>
    <option value="ãã®ä»–">ãã®ä»–</option>
  </select>
  <textarea id="contentInput" placeholder="å†…å®¹"></textarea>

  <div id="editButtons">
    <button onclick="saveNote()">ä¿å­˜</button>
    <button class="exportBtn" onclick="exportNote()">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
    <button class="deleteBtn" onclick="deleteNote()">å‰Šé™¤</button>
    <button onclick="showList()">æˆ»ã‚‹</button>
  </div>
</div>

<div id="trashView" class="hidden">
  <ul id="trashList"></ul>
  <button onclick="showList()">æˆ»ã‚‹</button>
</div>

<!-- è¡¨ç¤ºã•ã‚Œãªã„å¾©å…ƒç”¨ inputï¼ˆé‡è¦ï¼‰ -->
<input
  type="file"
  id="backupInput"
  accept=".json"
  style="display:none"
/>

<script>
let db;
let currentId = null;

const request = indexedDB.open("memoDB", 1);

request.onupgradeneeded = e => {
  const db = e.target.result;
  db.createObjectStore("notes", { keyPath: "id" });
};

request.onsuccess = e => {
  db = e.target.result;
  loadList();
};

function restoreAll() {
  document.getElementById("backupInput").click();
}

backupInput.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    const notes = JSON.parse(reader.result);
    const store = db.transaction("notes", "readwrite").objectStore("notes");
    notes.forEach(n => store.put(n));
    alert("å¾©å…ƒå®Œäº†");
    showList();
  };
  reader.readAsText(file);
};

/* ä»¥ä¸‹ãƒ­ã‚¸ãƒƒã‚¯ã¯å¤‰æ›´ãªã— */
</script>

</body>
</html>
